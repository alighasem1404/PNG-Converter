<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PNG to JPG Batch Converter & Downloader</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for textarea */
        textarea::-webkit-scrollbar {
            width: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #2d3748; /* Darker track for dark mode */
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb {
            background: #4a5568; /* Darker thumb for dark mode */
            border-radius: 10px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #6a758a;
        }
    </style>
</head>
<body class="bg-gray-900 min-h-screen flex flex-col items-center justify-center p-4">
    <div class="bg-gray-800 p-8 rounded-xl shadow-lg w-full max-w-2xl text-center">
        <h1 class="text-3xl font-bold mb-6 text-white">Batch PNG to JPG Converter</h1>
        <p class="text-gray-300 mb-6">Enter one or more PNG image URLs below, each on a new line. Then, provide corresponding names for the output JPG files (one name per line). The converted JPGs will be downloaded to your device.</p>

        <!-- PNG URLs Input -->
        <div class="mb-6 text-left">
            <label for="pngUrlInput" class="block text-gray-200 text-sm font-bold mb-2">PNG Image URLs:</label>
            <textarea id="pngUrlInput"
                      class="w-full h-48 p-4 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white placeholder-gray-400"
                      placeholder="Enter PNG image URLs here (one per line):
e.g.,
https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png
https://www.libpng.org/pub/png/images/agif_test.png"
            ></textarea>
        </div>

        <!-- Image Names Input -->
        <div class="mb-6 text-left">
            <label for="imageNamesInput" class="block text-gray-200 text-sm font-bold mb-2">Desired Image Names (for JPGs):</label>
            <textarea id="imageNamesInput"
                      class="w-full h-32 p-4 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-700 text-white placeholder-gray-400"
                      placeholder="Enter desired names for the output JPGs (one per line, must match URL order):
e.g.,
My_First_Image
Test_Image_from_LibPNG"
            ></textarea>
            <p class="text-gray-400 text-xs mt-1">Make sure the number of names matches the number of URLs.</p>
        </div>

        <button id="convertAndDownloadButton"
                class="bg-blue-600 text-white px-8 py-3 rounded-md font-semibold hover:bg-blue-700 transition duration-300 ease-in-out shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75">
            Convert & Download All JPGs
        </button>

        <div id="statusMessage" class="mt-6 p-4 rounded-md text-sm text-center font-medium" style="display: none;"></div>

        <!-- Hidden canvas for image conversion -->
        <canvas id="conversionCanvas" class="hidden"></canvas>
    </div>

    <script>
        const pngUrlInput = document.getElementById('pngUrlInput');
        const imageNamesInput = document.getElementById('imageNamesInput'); // New input
        const convertAndDownloadButton = document.getElementById('convertAndDownloadButton');
        const statusMessage = document.getElementById('statusMessage');
        const canvas = document.getElementById('conversionCanvas');
        const ctx = canvas.getContext('2d');

        /**
         * Displays a message to the user in the status area.
         * @param {string} msg The message to display.
         * @param {'info'|'success'|'error'} type The type of message for styling.
         */
        function showStatus(msg, type = 'info') {
            statusMessage.textContent = msg;
            statusMessage.style.display = msg ? 'block' : 'none';
            statusMessage.className = `mt-6 p-4 rounded-md text-sm text-center font-medium ${
                type === 'success' ? 'bg-green-700 text-green-100' :
                type === 'error' ? 'bg-red-700 text-red-100' :
                'bg-blue-700 text-blue-100'
            }`;
        }

        /**
         * Fetches an image from a URL, draws it to a canvas, and converts it to JPG.
         * @param {string} url The URL of the PNG image.
         * @returns {Promise<string|null>} A promise that resolves with the JPG Data URL or null if conversion fails.
         */
        async function convertPngToJpg(url) {
            return new Promise((resolve) => {
                const img = new Image();
                // To prevent CORS issues when loading images from other domains
                // If images are on different domains and don't allow CORS, this will fail.
                img.crossOrigin = "Anonymous";

                img.onload = () => {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    try {
                        // Convert to JPG data URL with a quality of 0.9 (0 to 1, 1 being highest quality)
                        const jpgDataUrl = canvas.toDataURL('image/jpeg', 0.9);
                        resolve(jpgDataUrl);
                    } catch (e) {
                        console.error(`Error converting image ${url} to JPG:`, e);
                        showStatus(`Failed to convert image from ${url}. It might be a CORS issue or invalid image.`, 'error');
                        resolve(null);
                    }
                };

                img.onerror = (e) => {
                    console.error(`Error loading image from ${url}:`, e);
                    showStatus(`Failed to load image from ${url}. Please check the URL or CORS settings.`, 'error');
                    resolve(null);
                };

                img.src = url;
            });
        }

        /**
         * Triggers the download of a Data URL as a file.
         * @param {string} dataUrl The Data URL of the file (e.g., 'data:image/jpeg;base64,...').
         * @param {string} filename The desired filename for the downloaded file.
         */
        function downloadFile(dataUrl, filename) {
            const a = document.createElement('a');
            a.href = dataUrl;
            a.download = filename; // Suggests a filename for the download
            document.body.appendChild(a); // Append to body to make it clickable
            a.click(); // Programmatically click the link to trigger download
            document.body.removeChild(a); // Clean up the element
        }

        convertAndDownloadButton.addEventListener('click', async () => {
            const urlsText = pngUrlInput.value.trim();
            const namesText = imageNamesInput.value.trim(); // Get names input

            if (!urlsText) {
                showStatus('Please enter at least one PNG image URL.', 'error');
                return;
            }

            // Split the input text into an array of URLs, filtering out empty lines
            const pngUrls = urlsText.split('\n').map(url => url.trim()).filter(url => url.length > 0);
            // Split the names text into an array of names, filtering out empty lines
            const imageNames = namesText.split('\n').map(name => name.trim()).filter(name => name.length > 0);

            if (pngUrls.length === 0) {
                showStatus('No valid PNG URLs found.', 'error');
                return;
            }

            // Check if the number of names matches the number of URLs
            if (namesText && imageNames.length !== pngUrls.length) {
                showStatus(`Error: Number of image names (${imageNames.length}) does not match number of URLs (${pngUrls.length}). Please provide one name per URL.`, 'error');
                return;
            }

            convertAndDownloadButton.disabled = true;
            showStatus(`Starting conversion and download for ${pngUrls.length} image(s)...`, 'info');

            let successfulConversions = 0;
            let failedConversions = 0;

            for (let i = 0; i < pngUrls.length; i++) {
                const url = pngUrls[i];
                let desiredName = imageNames[i]; // Get the desired name for the current URL

                // Fallback if no specific name is provided or if it's empty
                if (!desiredName) {
                    // Extract a filename from the URL, or use a generic one
                    let urlFilename = url.substring(url.lastIndexOf('/') + 1);
                    if (urlFilename.includes('?')) { // Remove query parameters from filename
                        urlFilename = urlFilename.substring(0, urlFilename.indexOf('?'));
                    }
                    if (!urlFilename || urlFilename.length === 0 || urlFilename.includes('.')) {
                        desiredName = `converted_image_${i + 1}`;
                    } else {
                        desiredName = urlFilename;
                    }
                }

                showStatus(`Processing image ${i + 1} of ${pngUrls.length} (${desiredName}.jpg)...`, 'info');

                const jpgDataUrl = await convertPngToJpg(url);

                if (jpgDataUrl) {
                    const filename = `${desiredName}.jpg`; // Ensure .jpg extension
                    downloadFile(jpgDataUrl, filename);
                    successfulConversions++;
                } else {
                    failedConversions++;
                }
            }

            convertAndDownloadButton.disabled = false;

            if (successfulConversions > 0 && failedConversions === 0) {
                showStatus(`All ${successfulConversions} image(s) converted and downloaded successfully!`, 'success');
            } else if (successfulConversions > 0 && failedConversions > 0) {
                showStatus(`Completed. ${successfulConversions} image(s) converted, ${failedConversions} failed. Check console for details.`, 'info');
            } else {
                showStatus(`No images could be converted. Please check URLs and try again.`, 'error');
            }
        });
    </script>
</body>
</html>
